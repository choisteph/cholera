<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
<ul>
<li>note on duplicate and missing cases</li>
</ul> • cholera</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="&lt;ul&gt;
&lt;li&gt;note on duplicate and missing cases&lt;/li&gt;
&lt;/ul&gt;">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">cholera</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.9.9024</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/duplicate.missing.cases.html">Duplicate and Missing Cases</a>
    </li>
    <li>
      <a href="../../articles/kernel.density.html">Kernel Density Plot</a>
    </li>
    <li>
      <a href="../../articles/notes/duplicate.missing.cases.notes.html">* note on duplicate and missing cases</a>
    </li>
    <li>
      <a href="../../articles/notes/euclidean.voronoi.html">* Euclidean v. Voronoi neighborhoods</a>
    </li>
    <li>
      <a href="../../articles/notes/pump.neighborhoods.notes.html">* points v. polygons</a>
    </li>
    <li>
      <a href="../../articles/notes/references.html">* References</a>
    </li>
    <li>
      <a href="../../articles/notes/unstacking.bars.notes.html">* computing street addressess</a>
    </li>
    <li>
      <a href="../../articles/pump.neighborhoods.html">Pump Neighborhoods</a>
    </li>
    <li>
      <a href="../../articles/roads.html">Roads</a>
    </li>
    <li>
      <a href="../../articles/tiles.polygons.html">deldirPolygons(): Tiles, Triangles and Polygons</a>
    </li>
    <li>
      <a href="../../articles/time.series.html">Time Series</a>
    </li>
    <li>
      <a href="../../articles/unstacking.bars.html">"Unstacking" Bars</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lindbrook/cholera">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1><ul>
<li>note on duplicate and missing cases</li>
</ul></h1>
                        <h4 class="author">lindbrook</h4>
            
            <h4 class="date">2019-01-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lindbrook/cholera/blob/master/vignettes/notes/duplicate.missing.cases.notes.Rmd"><code>vignettes/notes/duplicate.missing.cases.notes.Rmd</code></a></small>
      <div class="hidden name"><code>duplicate.missing.cases.notes.Rmd</code></div>

    </div>

    
    
<div id="duplicate-cases-cambridge-street" class="section level2">
<h2 class="hasAnchor">
<a href="#duplicate-cases-cambridge-street" class="anchor"></a>Duplicate Cases: Cambridge Street</h2>
<p>The three pairs of duplicates lie at two different locations on opposite sides of Cambridge Street:</p>
<p><img src="duplicate.missing.cases.notes_files/figure-html/unnamed-chunk-2-1.png" width="576" style="display: block; margin: auto auto auto 0;"></p>
</div>
<div id="missing-cases-broad-street" class="section level2">
<h2 class="hasAnchor">
<a href="#missing-cases-broad-street" class="anchor"></a>Missing Cases: Broad Street</h2>
<p>40 Broad Street, which lies just southwest (below and to the left) of the Broad Street Pump, is the location of two of the “missing” cases.</p>
<p>Snow’s map shows four “bars” or cases:</p>
<div class="figure">
<img src="../../../../Data%20IV/cholera/vignettes/notes/broad.street.A.png">
</div>
<p>But Dodson and Tobler’s data show only two, cases 32 and 122. Furthermore, the two cases also appear to be farther apart than what we see in nearby stacks:</p>
<p><img src="duplicate.missing.cases.notes_files/figure-html/unnamed-chunk-3-1.png" width="576" style="display: block; margin: auto auto auto 0;"></p>
</div>
<div id="missing-cases-noel-street" class="section level2">
<h2 class="hasAnchor">
<a href="#missing-cases-noel-street" class="anchor"></a>Missing Cases: Noel Street</h2>
<p>15 Noel Street, which lies north of Broad Street one block south of Oxford Street at the intersection with Berwick Street, is the location of the third “missing” case.</p>
<p>Snow’s map shows three cases at the end of Noel Street:</p>
<div class="figure">
<img src="../../../../Data%20IV/cholera/vignettes/notes/noel.street.png">
</div>
<p>But Dodson and Tobler’s data shows only two cases: 282 and 422. They also appear to be farther apart than what we see in nearby stacks:</p>
<p><img src="duplicate.missing.cases.notes_files/figure-html/unnamed-chunk-4-1.png" width="576" style="display: block; margin: auto auto auto 0;"></p>
</div>
<div id="a-solution" class="section level2">
<h2 class="hasAnchor">
<a href="#a-solution" class="anchor"></a>A Solution</h2>
<p>One solution to these problems is to use the three duplicate observations from Cambridge Street to fill in for the three “missing” observations on Broad and Noel Streets. This is both plausible and reasonable.</p>
<p>What makes it plausible is that with the exception of the x-y coordinate of the case at the base of a stack, the remaining coordinates, which make up 44% (257/578) of all bars and which include the proposed locations for the three “missing” observations, do not represent the location of a case. They only serve to align bars within a stack. For this reason, there should be no objections to moving this class of bars.</p>
<p>What makes it reasonable is that I do not relocate bars by hand. Instead, I use simple geometric interpolation. I use existing observations in a stack to determine the “standard” <em>unit</em> distance between bars and then use multiples of that <em>unit</em> distance to position “missing” observations.</p>
<p>Consider 40 Broad Street. On Snow’s map, there are four cases but in Dodson and Tobler there are just two. Visual inspection leads me to make three claims: 1) the distance between the two observed cases, 32 and 122, is greater than that at neighboring stacks; 2) there appears to be room for one “missing” case between 32 and 122; and 3) the other “missing” case should be located just beyond case 122.</p>
<p>The proposed coordinates are illustrated below:</p>
<p><img src="duplicate.missing.cases.notes_files/figure-html/unnamed-chunk-6-1.png" width="576" style="display: block; margin: auto auto auto 0;"></p>
</div>
<div id="geometric-interpolation-unit-distance" class="section level2">
<h2 class="hasAnchor">
<a href="#geometric-interpolation-unit-distance" class="anchor"></a>Geometric interpolation: <em>unit</em> distance</h2>
<p>To explain how I got these coordinates, I illustrate the computation of the <em>unit</em> distance in one dimension and then move to the two dimensional case.</p>
<p>I use 40 Broad Street as the example. I rotate the data so that the stack lies along a single (horizontal) dimension. To fit one “missing” case between cases 32 and 122, I set the <em>unit</em> distance between the two observed cases to 2:</p>
<p><img src="duplicate.missing.cases.notes_files/figure-html/unnamed-chunk-7-1.png" width="480" style="display: block; margin: auto auto auto 0;"></p>
<p>I then place one “missing” case 1 <em>unit</em> away from 32:</p>
<p><img src="duplicate.missing.cases.notes_files/figure-html/unnamed-chunk-8-1.png" width="480" style="display: block; margin: auto auto auto 0;"></p>
<p>And place the other “missing” case three <em>units</em> away:</p>
<p><img src="duplicate.missing.cases.notes_files/figure-html/unnamed-chunk-9-1.png" width="480" style="display: block; margin: auto auto auto 0;"></p>
</div>
<div id="geometric-interpolation-in-2-dimensions" class="section level2">
<h2 class="hasAnchor">
<a href="#geometric-interpolation-in-2-dimensions" class="anchor"></a>Geometric interpolation: in 2 dimensions</h2>
<p>Because stacks lie in two dimensional space and because we need to respect geographical features like roads, the actual interpolation is a bit more complicated.</p>
<p>Consider the example of the “missing” observation that lies between cases 32 and 122. Just as with the one dimensional example, the “missing” observation should be located one <em>unit</em> away from case 32. The difference in two dimensions is that it needs to be located one <em>unit</em> away from case 32 (at the red “x”) as measured along the line that runs through the stack’s axis (black dotted line).</p>
<p><img src="duplicate.missing.cases.notes_files/figure-html/unnamed-chunk-11-1.png" width="576" style="display: block; margin: auto auto auto 0;"></p>
<p>To compute the coordinates for the “missing” case, I find the points of intersection between a circle and line. The circle is simple: its center is the case or reference point (case 32), and its radius is the desired multiple of the <em>unit</em> distance, which is 1 in this example. The line is more complicated: it’s the line that runs through the stack’s axis.</p>
<p>What makes the line complicated is that the bars in the stacks in Dodson and Tobler are generally <em>not</em> perfectly aligned. To ensure that there is only one unique axis for any stack, I impose two constraints: 1) a stack must lie along an axis that is orthogonal to the road (line segment) where the stack is located<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>; and 2) the axis must pass through the reference point, the bar at the base of the stack (i.e., the bar closest to the stack’s home road segment).</p>
<p>As a consequence, the line drawn through the stack’s axis will pass through the circle’s center:</p>
<p><img src="duplicate.missing.cases.notes_files/figure-html/unnamed-chunk-12-1.png" width="576" style="display: block; margin: auto auto auto 0;"></p>
<p>There will always be two points of intersection (red squares):</p>
<p><img src="duplicate.missing.cases.notes_files/figure-html/unnamed-chunk-13-1.png" width="576" style="display: block; margin: auto auto auto 0;"></p>
<p>So, finding the coordinates of the “missing” observations boils down to solving a quadratic equation and picking the appropriate solution.</p>
<p><img src="duplicate.missing.cases.notes_files/figure-html/unnamed-chunk-14-1.png" width="576" style="display: block; margin: auto auto auto 0;"></p>
<p>I do so using with the formulas below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Equation of line for the "home" road segment</span>
<span class="co"># "segment" is the numeric ID of one of the 528 sets of line segments in Dodson and Tobler</span>
segmentOLS &lt;-<span class="st"> </span><span class="cf">function</span>(segment) {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> street.list[[segment]])
}

<span class="co"># Slope for orthogonal stack axis</span>
orthogonalSlope &lt;-<span class="st"> </span><span class="cf">function</span>(segment) {
  ols &lt;-<span class="st"> </span><span class="kw">segmentOLS</span>(segment)
  <span class="op">-</span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(ols)[<span class="dv">2</span>]
}

<span class="co"># Intercept for orthogonal stack axis</span>
<span class="co"># "case" if the reference point of a stack</span>
orthogonalIntercept &lt;-<span class="st"> </span><span class="cf">function</span>(case, segment) {
  Snow.deaths[case, <span class="st">"y"</span>] <span class="op">-</span><span class="st"> </span><span class="kw">orthogonalSlope</span>(segment) <span class="op">*</span><span class="st"> </span>Snow.deaths[case, <span class="st">"x"</span>]
}

<span class="co"># unit distance is a function of the Euclidean distance between "case1" and "case2"</span>
unitDistance &lt;-<span class="st"> </span><span class="cf">function</span>(case1, case2) {
  <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/dist">dist</a></span>(Snow.deaths[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(case1, case2), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"x"</span>, <span class="st">"y"</span>)])
}

<span class="co"># Quadratic equation</span>
quadratic &lt;-<span class="st"> </span><span class="cf">function</span>(a, b, c) {
  root1 &lt;-<span class="st"> </span>(<span class="op">-</span>b <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(b<span class="op">^</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span><span class="dv">4</span> <span class="op">*</span><span class="st"> </span>a <span class="op">*</span><span class="st"> </span>c)) <span class="op">/</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>a)
  root2 &lt;-<span class="st"> </span>(<span class="op">-</span>b <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">sqrt</a></span>(b<span class="op">^</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span><span class="dv">4</span> <span class="op">*</span><span class="st"> </span>a <span class="op">*</span><span class="st"> </span>c)) <span class="op">/</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>a)
  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(root1, root2)
}

<span class="co"># Geometric interpolation</span>
<span class="co"># "multiplier" scales and defines the unit distance</span>
interpolatedPoints &lt;-<span class="st"> </span><span class="cf">function</span>(case1, case2, segment, <span class="dt">multiplier =</span> <span class="fl">0.5</span>) {
  p &lt;-<span class="st"> </span>Snow.deaths[case1, <span class="st">"x"</span>]
  q &lt;-<span class="st"> </span>Snow.deaths[case1, <span class="st">"y"</span>]
  radius &lt;-<span class="st"> </span>multiplier <span class="op">*</span><span class="st"> </span><span class="kw">unitDistance</span>(case1, case2)
  m &lt;-<span class="st"> </span><span class="kw">orthogonalSlope</span>(segment)
  b &lt;-<span class="st"> </span><span class="kw">orthogonalIntercept</span>(case1)
  A &lt;-<span class="st"> </span>(m<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)
  B &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(m <span class="op">*</span><span class="st"> </span>b <span class="op">-</span><span class="st"> </span>m <span class="op">*</span><span class="st"> </span>q <span class="op">-</span><span class="st"> </span>p)
  C &lt;-<span class="st"> </span>(q<span class="op">^</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>radius<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>p<span class="op">^</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>b <span class="op">*</span><span class="st"> </span>q <span class="op">+</span><span class="st"> </span>b<span class="op">^</span><span class="dv">2</span>)
  <span class="kw">quadratic</span>(A, B, C)
}</code></pre></div>
</div>
<div id="proposed-coordinates" class="section level2">
<h2 class="hasAnchor">
<a href="#proposed-coordinates" class="anchor"></a>Proposed coordinates</h2>
<p>Using this approach, I get the following results. For the two “missing” cases at 40 Broad Street, I move two duplicates, cases 91 and 93, from Cambridge Street:</p>
<p><img src="duplicate.missing.cases.notes_files/figure-html/unnamed-chunk-16-1.png" width="576" style="display: block; margin: auto auto auto 0;"></p>
<p>For the missing case at 15 Noel Street, I move the remaining duplicate, case 209, from Cambridge Street:</p>
<p><img src="duplicate.missing.cases.notes_files/figure-html/unnamed-chunk-17-1.png" width="576" style="display: block; margin: auto auto auto 0;"></p>
</div>
<div id="notes" class="section level2">
<h2 class="hasAnchor">
<a href="#notes" class="anchor"></a>Notes</h2>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>For an explanation on how the home road segment is identified, see the “‘Unstacking’ Bars” vignette.<a href="#fnref1">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#duplicate-cases-cambridge-street">Duplicate Cases: Cambridge Street</a></li>
      <li><a href="#missing-cases-broad-street">Missing Cases: Broad Street</a></li>
      <li><a href="#missing-cases-noel-street">Missing Cases: Noel Street</a></li>
      <li><a href="#a-solution">A Solution</a></li>
      <li><a href="#geometric-interpolation-unit-distance">Geometric interpolation: <em>unit</em> distance</a></li>
      <li><a href="#geometric-interpolation-in-2-dimensions">Geometric interpolation: in 2 dimensions</a></li>
      <li><a href="#proposed-coordinates">Proposed coordinates</a></li>
      <li><a href="#notes">Notes</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by lindbrook.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
