<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
<ul>
<li>points v. polygons</li>
</ul> • cholera</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="&lt;ul&gt;
&lt;li&gt;points v. polygons&lt;/li&gt;
&lt;/ul&gt;">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">cholera</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.9.9024</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/duplicate.missing.cases.html">Duplicate and Missing Cases</a>
    </li>
    <li>
      <a href="../../articles/kernel.density.html">Kernel Density Plot</a>
    </li>
    <li>
      <a href="../../articles/notes/duplicate.missing.cases.notes.html">* note on duplicate and missing cases</a>
    </li>
    <li>
      <a href="../../articles/notes/euclidean.voronoi.html">* Euclidean v. Voronoi neighborhoods</a>
    </li>
    <li>
      <a href="../../articles/notes/pump.neighborhoods.notes.html">* points v. polygons</a>
    </li>
    <li>
      <a href="../../articles/notes/references.html">* References</a>
    </li>
    <li>
      <a href="../../articles/notes/unstacking.bars.notes.html">* computing street addressess</a>
    </li>
    <li>
      <a href="../../articles/pump.neighborhoods.html">Pump Neighborhoods</a>
    </li>
    <li>
      <a href="../../articles/roads.html">Roads</a>
    </li>
    <li>
      <a href="../../articles/tiles.polygons.html">deldirPolygons(): Tiles, Triangles and Polygons</a>
    </li>
    <li>
      <a href="../../articles/time.series.html">Time Series</a>
    </li>
    <li>
      <a href="../../articles/unstacking.bars.html">"Unstacking" Bars</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lindbrook/cholera">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1><ul>
<li>points v. polygons</li>
</ul></h1>
                        <h4 class="author">lindbrook</h4>
            
            <h4 class="date">2019-01-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lindbrook/cholera/blob/master/vignettes/notes/pump.neighborhoods.notes.Rmd"><code>vignettes/notes/pump.neighborhoods.notes.Rmd</code></a></small>
      <div class="hidden name"><code>pump.neighborhoods.notes.Rmd</code></div>

    </div>

    
    
<p>There are two types of “expected” pump neighborhood area plots. The first is based on graphics::points(); the second is based on graphics::polygon().</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../../reference/neighborhoodWalking.html">neighborhoodWalking</a></span>(<span class="dt">vestry =</span> <span class="ot">TRUE</span>, <span class="dt">case.set =</span> <span class="st">"expected"</span>),
  <span class="dt">type =</span> <span class="st">"area.points"</span>)</code></pre></div>
<p><img src="pump.neighborhoods.notes_files/figure-html/area_points-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../../reference/neighborhoodWalking.html">neighborhoodWalking</a></span>(<span class="dt">vestry =</span> <span class="ot">TRUE</span>, <span class="dt">case.set =</span> <span class="st">"expected"</span>),
  <span class="dt">type =</span> <span class="st">"area.polygons"</span>)</code></pre></div>
<p><img src="pump.neighborhoods.notes_files/figure-html/area_polygons-1.png" width="480" style="display: block; margin: auto;"></p>
<div id="why-two-types" class="section level2">
<h2 class="hasAnchor">
<a href="#why-two-types" class="anchor"></a>why two types?</h2>
<p>The reason for two is that while the points() based approach is computationally faster, the polygon() approach has vector graphics on its side. In certain applications, when you zoom in you’ll see the granularity of the points() based approach:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/streetNameLocator.html">streetNameLocator</a></span>(<span class="st">"marshall street"</span>, <span class="dt">zoom =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="../../reference/addNeighborhoodCases.html">addNeighborhoodCases</a></span>(<span class="dt">type =</span> <span class="st">"expected"</span>)</code></pre></div>
<p><img src="pump.neighborhoods.notes_files/figure-html/marshall_points-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/streetNameLocator.html">streetNameLocator</a></span>(<span class="st">"marshall street"</span>, <span class="dt">zoom =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="../../reference/addNeighborhoodWalking.html">addNeighborhoodWalking</a></span>()</code></pre></div>
<p><img src="pump.neighborhoods.notes_files/figure-html/marshall_polygons-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="how-to-compute-neighborhood-area-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-compute-neighborhood-area-plots" class="anchor"></a>how to compute neighborhood area plots</h2>
<p>For both area plots, I use “expected” data to compute the expected neighborhood area. Using <code><a href="https://www.rdocumentation.org/packages/sp/topics/spsample">sp::spsample()</a></code> and <code><a href="https://www.rdocumentation.org/packages/sp/topics/SpatialPolygons">sp::Polygon()</a></code>, I place 20K regularly-spaced points across the face of the map (in the “real world”, points are approximately 6 meters apart.).<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/spsample">spsample</a></span>(sp<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/SpatialPolygons">Polygon</a></span>(map.frame[, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"x"</span>, <span class="st">"y"</span>)]), <span class="dt">n =</span> <span class="dv">20000</span>, <span class="dt">type =</span> <span class="st">"regular"</span>)</code></pre></div>
<p>For each simulated case, I compute the closet water pump using Euclidean and walking distances. The details are in <code><a href="../../reference/simulateFatalities.html">cholera::simulateFatalities()</a></code>, located in <a href="https://github.com/lindbrook/cholera/blob/master/R/simulateFatalities.R">simulateFatalities.R</a>.</p>
<p>This classifies the “expected” or simulated cases by pump neighborhood. By coloring the points by “their” pump, the different pump neighborhoods will emerge.</p>
</div>
<div id="how-to-compute-polygon-vertices" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-compute-polygon-vertices" class="anchor"></a>how to compute polygon vertices</h2>
<p>To use polygon(), we need the vertices. To my knowledge, this is not a simple, straightforward task.</p>
<p>Using the case of pump the Broad Street pump (#7) and walking distance as the measure of proximity, I illustrate my approach. By my calculation, 1,709 of the simulated cases fall within the Broad Street pump neighborhood:</p>
<div class="figure">
<img src="../../../../Data%20IV/cholera/vignettes/notes/cloud-1.png">
</div>
<p>While the convex hull may be the first thing that comes to mind, it’s not a good general solution. This is because the convex hull creates a polygon based on the most outlying points. As a result, when there are concavities, points outside the neighborhood will fall within the resulting polygon:</p>
<div class="figure">
<img src="../../../../Data%20IV/cholera/vignettes/notes/hull-1.png">
</div>
<p>To find the vertices of the pump neighborhood polygon, I’d argue that we want the points along the perimeter to serve as the vertices of the polygon. To identify these points, I select the point that <em>do not</em> have neighbors at each of the four cardinal directions (i.e., North, South, East and West). See peripheryCases().</p>
<div class="figure">
<img src="../../../../Data%20IV/cholera/vignettes/notes/perimeter-1.png">
</div>
<p>The final task is to connect the dots in the right order. Essentially, we want to add pearls to a string to form the polygon.</p>
<div class="figure">
<img src="../../../../Data%20IV/cholera/vignettes/notes/pearl_string-1.png">
</div>
</div>
<div id="string-of-pearls-algorithms" class="section level2">
<h2 class="hasAnchor">
<a href="#string-of-pearls-algorithms" class="anchor"></a>String of pearls algorithms</h2>
<p>I have coded two workable solutions that aim to connect the dots in the “right” order.<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> The first, <a href="https://github.com/lindbrook/cholera/blob/master/R/pearlString.R">pearlString()</a>, cycles through the candidate points and uses reverse <a href="https://en.wikipedia.org/wiki/Deferent_and_epicycle">epicycles</a> to find the next point to add to the string of pearls. This is the default for walking neighborhoods. The second, <a href="https://github.com/lindbrook/cholera/blob/master/R/pearlString.R">travelingSalesman()</a>, uses the ‘TSP’ package and its implementation of repetitive nearest neighbors to compute the string of pearls. This is the default for Euclidean neighborhoods.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">neighborhood &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/neighborhoodWalking.html">neighborhoodWalking</a></span>(<span class="op">-</span><span class="dv">6</span>, <span class="dt">case.set =</span> <span class="st">"expected"</span>, <span class="dt">vestry =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(neighborhood, <span class="dt">type =</span> <span class="st">"area.polygons"</span>, <span class="dt">method =</span> <span class="st">"pearl.string"</span>)</code></pre></div>
<p><img src="pump.neighborhoods.notes_files/figure-html/pearl_string-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">neighborhood &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/neighborhoodWalking.html">neighborhoodWalking</a></span>(<span class="op">-</span><span class="dv">6</span>, <span class="dt">case.set =</span> <span class="st">"expected"</span>, <span class="dt">vestry =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(neighborhood, <span class="dt">type =</span> <span class="st">"area.polygons"</span>, <span class="dt">method =</span> <span class="st">"traveling.salesman"</span>)</code></pre></div>
<p><img src="pump.neighborhoods.notes_files/figure-html/traveling-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="why-20k-observations" class="section level2">
<h2 class="hasAnchor">
<a href="#why-20k-observations" class="anchor"></a>why 20K observations?</h2>
<p>Of equal, if not greater importance is the density of simulated cases. As far as pearlString() is concerned, I found that the algorithm can fail by getting stuck in dead ends or by skipping over points. As is often the case, more data helps. As a tradeoff between computational speed and functional robustness, I ended up using 20K simulated cases.</p>
</div>
<div id="expected-areas-v--expected-roads-" class="section level2">
<h2 class="hasAnchor">
<a href="#expected-areas-v--expected-roads-" class="anchor"></a>Expected areas v. expected roads.</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../../reference/neighborhoodWalking.html">neighborhoodWalking</a></span>(<span class="dt">case.set =</span> <span class="st">"expected"</span>))</code></pre></div>
<p><img src="pump.neighborhoods.notes_files/figure-html/roads-1.png" width="480" style="display: block; margin: auto;"></p>
<p>While easier to “read”, the area plots are potentially misleading. Conceptually, the problem is that they take the focus away from roads and puts it on regions, which may not be meaningful because they can represent locations where there are no roads or residences. Computationally, the problem is that the shape of a neighborhood will be sensitive to how we determines a case’s street address. Different implementations can produce different results.</p>
</div>
<div id="notes" class="section level2">
<h2 class="hasAnchor">
<a href="#notes" class="anchor"></a>notes</h2>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Because the map frame is not rectangular, the actual number of points is 19,993.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>Originally, I used the ‘alphahull’ package. But doing so not only requires tweaking a parameter, it also has a license, ACM, that generates a warning on CRAN Package Check.<a href="#fnref2">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#why-two-types">why two types?</a></li>
      <li><a href="#how-to-compute-neighborhood-area-plots">how to compute neighborhood area plots</a></li>
      <li><a href="#how-to-compute-polygon-vertices">how to compute polygon vertices</a></li>
      <li><a href="#string-of-pearls-algorithms">String of pearls algorithms</a></li>
      <li><a href="#why-20k-observations">why 20K observations?</a></li>
      <li><a href="#expected-areas-v--expected-roads-">Expected areas v. expected roads.</a></li>
      <li><a href="#notes">notes</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by lindbrook.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
