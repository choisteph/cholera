<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pump Neighborhoods • cholera</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Pump Neighborhoods">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cholera</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.9.9024</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/duplicate.missing.cases.html">Duplicate and Missing Cases</a>
    </li>
    <li>
      <a href="../articles/kernel.density.html">Kernel Density Plot</a>
    </li>
    <li>
      <a href="../articles/notes/duplicate.missing.cases.notes.html">* note on duplicate and missing cases</a>
    </li>
    <li>
      <a href="../articles/notes/euclidean.voronoi.html">* Euclidean v. Voronoi neighborhoods</a>
    </li>
    <li>
      <a href="../articles/notes/pump.neighborhoods.notes.html">* points v. polygons</a>
    </li>
    <li>
      <a href="../articles/notes/references.html">* References</a>
    </li>
    <li>
      <a href="../articles/notes/unstacking.bars.notes.html">* computing street addressess</a>
    </li>
    <li>
      <a href="../articles/pump.neighborhoods.html">Pump Neighborhoods</a>
    </li>
    <li>
      <a href="../articles/roads.html">Roads</a>
    </li>
    <li>
      <a href="../articles/tiles.polygons.html">deldirPolygons(): Tiles, Triangles and Polygons</a>
    </li>
    <li>
      <a href="../articles/time.series.html">Time Series</a>
    </li>
    <li>
      <a href="../articles/unstacking.bars.html">"Unstacking" Bars</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lindbrook/cholera">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Pump Neighborhoods</h1>
                        <h4 class="author">lindbrook</h4>
            
            <h4 class="date">2019-01-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lindbrook/cholera/blob/master/vignettes/pump.neighborhoods.Rmd"><code>vignettes/pump.neighborhoods.Rmd</code></a></small>
      <div class="hidden name"><code>pump.neighborhoods.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>John Snow published two versions of the cholera map. The first, which appeared in <em>On The Mode Of Communication Of Cholera</em> (Snow 1855a), is more famous. The second, which appeared in the <em>Report On The Cholera Outbreak In The Parish Of St. James, Westminster, During The Autumn Of 1854</em> (Snow 1855b), is more important. What makes it so is that Snow adds a graphical annotation that outlines the neighborhood around the Broad Street pump, the set of addresses that he contends is most likely to use the pump:</p>
<div class="figure">
<img src="../../../Data%20IV/cholera/vignettes/fig12-6.png">
</div>
<p>By identifying the pump’s neighborhood, Snow sets limits on where we should and where we should <em>not</em> find fatalities. Ideally, this would help support his claims that cholera is a waterborne disease and that the Broad Street pump is the source of the outbreak. Looking at the second map Snow writes: “it will be observed that the deaths either very much diminish, or cease altogether, at every point where it becomes decidedly nearer to send to another pump than to the one in Broad street” (Snow 1855b, 109).</p>
<p>To help assess whether the map supports Snow’s arguments, I provide functions that allow you to analyze and visualize two flavors of pump neighborhoods: Voronoi tessellation, which is based on the Euclidean distance between pumps, and walking distance, which is based on the paths traveled along the network of roads. In either case, the guiding principle is the same. All else being equal, people will choose the closest pump.</p>
<div id="voronoi-tessellation" class="section level3">
<h3 class="hasAnchor">
<a href="#voronoi-tessellation" class="anchor"></a>Voronoi tessellation</h3>
<p>Cliff and Haggett (1988) appear to be the first to use Voronoi tessellation<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> to compute pump neighborhoods. In their digitization of Snow’s map, Dodson and Tobler (1992) include coordinates for 13 Voronoi cells. These are available in <code><a href="https://www.rdocumentation.org/packages/HistData/topics/Snow">HistData::Snow.polygons</a></code>. To replicate that effort, I use <code><a href="https://www.rdocumentation.org/packages/deldir/topics/deldir">deldir::deldir()</a></code>. With the exception of the border between the neighborhoods of the Market Place and the Adam and Eve Court pumps (pumps #1 and #2), I find that Dodson and Tobler’s computation are otherwise identical to those using the ‘deldir’ package.</p>
<p>To explore the data using this approach, you can use <code><a href="../reference/neighborhoodVoronoi.html">neighborhoodVoronoi()</a></code> to create scenarios of different sets neighborhoods based on the pumps you select. The figure below plots the 321 fatality “addresses” and the Voronoi cells for the 13 pumps in the original map.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../reference/neighborhoodVoronoi.html">neighborhoodVoronoi</a></span>())</code></pre></div>
<p><img src="pump.neighborhoods_files/figure-html/unnamed-chunk-2-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The next figure below plots the same data but excludes consideration of the Broad Street pump.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../reference/neighborhoodVoronoi.html">neighborhoodVoronoi</a></span>(<span class="op">-</span><span class="dv">7</span>))</code></pre></div>
<p><img src="pump.neighborhoods_files/figure-html/unnamed-chunk-3-1.png" width="480" style="display: block; margin: auto;"></p>
<p>In either case, the numerical results can be summarized using the <code><a href="https://www.rdocumentation.org/packages/base/topics/print">print()</a></code> method. Note that “Pearson” is “Count” minus “Expected” divided by the square root of “Expected”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># print(neighborhoodVoronoi()) or</span>
<span class="kw"><a href="../reference/neighborhoodVoronoi.html">neighborhoodVoronoi</a></span>()</code></pre></div>
<pre><code>##  [1]   0   1  10  13   3  39 182  12  17  38   2   2   2</code></pre>
</div>
<div id="walking-distance" class="section level3">
<h3 class="hasAnchor">
<a href="#walking-distance" class="anchor"></a>Walking distance</h3>
<p>The obvious criticism against using Voronoi tessellation to analyze Snow’s map is that the neighborhoods it describes are based solely on the Euclidean distance between water pumps. Roads and buildings don’t matter. In this version of the world, people walk to water pumps in perfectly straight lines rather than along the twists and turns of paths created by roads and streets.</p>
<p>Not only is this unrealistic, it’s also contrary to how Snow thought about the problem. Snow’s graphical annotation appears to be based on a computation of walking distance. He writes: “The inner dotted line on the map shews [sic] the various points which have been found by careful measurement to be at an equal distance by the nearest road from the pump in Broad Street and the surrounding pumps …” (<em>Report On The Cholera Outbreak In The Parish Of St. James, Westminster, During The Autumn Of 1854</em>, p. 109.).</p>
<p>While the details of his computations seem to be lost to history, I replicate and extend his efforts by writing functions that allow you to compute and visualize pump neighborhoods based on walking distance.<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> My implementation works by transforming the roads on the map into a network graph and turning the computation of walking distance into a graph theory problem. For each case (observed or simulated), I compute the shortest path, weighted by the length of roads, to the nearest pump. Then, by drawing the unique paths for all cases, a pump’s neighborhood emerges:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../reference/neighborhoodWalking.html">neighborhoodWalking</a></span>())</code></pre></div>
<p><img src="pump.neighborhoods_files/figure-html/unnamed-chunk-5-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The summary results are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># print(neighborhoodWalking()) or</span>
<span class="kw"><a href="../reference/neighborhoodWalking.html">neighborhoodWalking</a></span>()</code></pre></div>
<pre><code>##   3   4   5   6   7   8   9  10  11  12 
##  12   6   1  44 189  14  32  20   2   1</code></pre>
</div>
<div id="expected-walking-neighborhoods" class="section level3">
<h3 class="hasAnchor">
<a href="#expected-walking-neighborhoods" class="anchor"></a>“Expected” walking neighborhoods</h3>
<p>To get a sense of the full extent of a walking neighborhood, I apply the approach above to use “expected” or simulated data. Using <code><a href="https://www.rdocumentation.org/packages/sp/topics/spsample">sp::spsample()</a></code> and <code><a href="https://www.rdocumentation.org/packages/sp/topics/SpatialPolygons">sp::Polygon()</a></code>, I place 20,000 regularly spaced points, which lie approximately 6 meters apart, <code><a href="../reference/unitMeter.html">unitMeter(dist(regular.cases[1:2, ]))</a></code>, across the map and essentially compute the shortest path to the nearest pump.<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a></p>
<p>I visualize the results in two ways. In the first, I identify neighborhoods by coloring roads.<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../reference/neighborhoodWalking.html">neighborhoodWalking</a></span>(<span class="dt">case.set =</span> <span class="st">"expected"</span>))</code></pre></div>
<p><img src="pump.neighborhoods_files/figure-html/unnamed-chunk-7-1.png" width="480" style="display: block; margin: auto;"></p>
<p>In the second, I identify neighborhoods by coloring regions using points or polygons.<a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a> The points approach, shown below, is faster and more robust.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../reference/neighborhoodWalking.html">neighborhoodWalking</a></span>(<span class="dt">case.set =</span> <span class="st">"expected"</span>), <span class="dt">type =</span> <span class="st">"area.points"</span>)</code></pre></div>
<p><img src="pump.neighborhoods_files/figure-html/unnamed-chunk-8-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="exploring-scenarios" class="section level3">
<h3 class="hasAnchor">
<a href="#exploring-scenarios" class="anchor"></a>Exploring scenarios</h3>
<p>Beyond comparing methods (e.g., walking v. Euclidean distance), this package also allows you to explore different scenarios. For example, Snow argues that residents found the water from the Carnaby and Little Marlborough Street pump (#6) to be of low quality and actually preferred to go to the Broad Street pump (#7).<a href="#fn6" class="footnoteRef" id="fnref6"><sup>6</sup></a> Using this package, you can explore this by selecting or excluding pumps:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../reference/neighborhoodWalking.html">neighborhoodWalking</a></span>(<span class="op">-</span><span class="dv">6</span>))</code></pre></div>
<p><img src="pump.neighborhoods_files/figure-html/unnamed-chunk-9-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="note-on-neighborhoodwalking" class="section level3">
<h3 class="hasAnchor">
<a href="#note-on-neighborhoodwalking" class="anchor"></a>Note on <code><a href="../reference/neighborhoodWalking.html">neighborhoodWalking()</a></code>
</h3>
<p><code><a href="../reference/neighborhoodWalking.html">neighborhoodWalking()</a></code> is computationally intensive. Using R version 3.5.1 on a single core of a 2.3 GHz Intel i7, plotting observed paths to PDF takes about 5 seconds; doing the same for expected paths takes about 28 seconds. Using the functions’ parallel implementation on 4 physical (8 logical) cores, the times fall to about 4 and 11 seconds.</p>
<p>Note that parallelization is currently only available on Linux and Mac.</p>
<p>Also, note that although some precautions are taken in R.app on macOS, the developers of the ‘parallel’ package, which <code><a href="../reference/neighborhoodWalking.html">neighborhoodWalking()</a></code> uses, strongly discourage against using parallelization within a GUI or embedded environment. See <code>vignette("parallel")</code> for details.</p>
</div>
</div>
<div id="notes" class="section level2">
<h2 class="hasAnchor">
<a href="#notes" class="anchor"></a>Notes</h2>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p><a href="http://www.ams.org/samplings/feature-column/fcarc-voronoi" class="uri">http://www.ams.org/samplings/feature-column/fcarc-voronoi</a><a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>The computation of walking distance is by no means new (see Shiode, 2012). Another approach is to use GIS. For applications that don’t need to consider the actual historic walking distances, this layers-based approach, which typically relies on current maps, may be sufficient: e.g., <a href="https://www.theguardian.com/news/datablog/2013/mar/15/john-snow-cholera-map" class="uri">https://www.theguardian.com/news/datablog/2013/mar/15/john-snow-cholera-map</a>. To reconstruct the roads represented on Snow’s map, one might also consider John Mackenzie’ approach at <a href="https://www1.udel.edu/johnmack/frec682/cholera/cholera2.html" class="uri">https://www1.udel.edu/johnmack/frec682/cholera/cholera2.html</a>.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>These data are found in <code>regular.cases</code>.<a href="#fnref3">↩</a></p></li>
<li id="fn4"><p>Shiode (2012) uses this approach.<a href="#fnref4">↩</a></p></li>
<li id="fn5"><p>Mackenzie (N.D) uses this area plot approach. Cliff and Haggett produce an adjusted Voronoi cells that reflect walking distances: “So far we have assumed that access to each pump was determined by ‘as-the-crow-flies’ distances. While the physical effort of carrying water mean that most people visited their nearest pump, recognition must be made of the complex street pattern in this area of London. Therefore in (D), the Thiessen polygons have been adjusted to take into account the patterns of access made possible by the street system shown in diagram (A)” (Cliff and Haggett 1988, 53). However, details about how this was done don’t appear to be available. Moreover, because the graphic only shows the outline of the polygon and not the streets, comparisons with other approaches is difficult.<a href="#fnref5">↩</a></p></li>
<li id="fn6"><p>Snow writes: “It requires to be stated that the water of the pump in Marlborough Street, at the end of Carnaby Street, was so impure that many persons avoided using it; and I found that the persons who died near this pump, in the beginning of September, had water from the Broad Street pump.”<a href="#fnref6">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#notes">Notes</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by lindbrook.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
