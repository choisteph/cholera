<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>“Unstacking” Bars • cholera</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="“Unstacking” Bars">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cholera</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.9.9024</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/duplicate.missing.cases.html">Duplicate and Missing Cases</a>
    </li>
    <li>
      <a href="../articles/kernel.density.html">Kernel Density Plot</a>
    </li>
    <li>
      <a href="../articles/notes/duplicate.missing.cases.notes.html">* note on duplicate and missing cases</a>
    </li>
    <li>
      <a href="../articles/notes/euclidean.voronoi.html">* Euclidean v. Voronoi neighborhoods</a>
    </li>
    <li>
      <a href="../articles/notes/pump.neighborhoods.notes.html">* points v. polygons</a>
    </li>
    <li>
      <a href="../articles/notes/references.html">* References</a>
    </li>
    <li>
      <a href="../articles/notes/unstacking.bars.notes.html">* computing street addressess</a>
    </li>
    <li>
      <a href="../articles/pump.neighborhoods.html">Pump Neighborhoods</a>
    </li>
    <li>
      <a href="../articles/roads.html">Roads</a>
    </li>
    <li>
      <a href="../articles/tiles.polygons.html">deldirPolygons(): Tiles, Triangles and Polygons</a>
    </li>
    <li>
      <a href="../articles/time.series.html">Time Series</a>
    </li>
    <li>
      <a href="../articles/unstacking.bars.html">"Unstacking" Bars</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lindbrook/cholera">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>“Unstacking” Bars</h1>
                        <h4 class="author">lindbrook</h4>
            
            <h4 class="date">2019-01-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lindbrook/cholera/blob/master/vignettes/unstacking.bars.Rmd"><code>vignettes/unstacking.bars.Rmd</code></a></small>
      <div class="hidden name"><code>unstacking.bars.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>In his map of the 1854 cholera outbreak in London, John Snow uses stacks of bars to represent the number of fatalities at a given address. A location with one fatality is represented by a single, horizontal bar that lies parallel to road where the fatality occurred. A location with five fatalities is represented by five horizontally stacked bars:<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<div class="figure">
<img src="../../../Data%20IV/cholera/vignettes/msu-snows-mapB.jpg">
</div>
<p>In 1992, Rusty Dodson and Waldo Tobler digitized the map. Each bar and pump is assigned a unique x-y coordinate. Each road is translated into a series of straight line segments, defined by the segment’s endpoints. While the original data are no longer available,<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> they are preserved in Michael Friendly’s ‘HistData’ package. The data are plotted below:</p>
<p><img src="unstacking.bars_files/figure-html/unnamed-chunk-2-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Despite its appeal, I would argue that stacked bars are visually and computationally problematic. The reason, simply put, is that not all bars are created equal. Even though they are identical in terms of their appearance and the only thing that appears to distinguish them is their location, bars can actually play different roles.</p>
<p>Sometimes a bar represents the location of a fatality, sometimes it doesn’t. Standalone bars, a stack with a single bar (i.e., an addresses with one fatality), or the bar at the base of a stack represent a location. Bars above the base case do not. They exist only to create the stacking effect to visually represent the number of fatalities at the address.</p>
<p>This duality is problematic. Because a map is a visual device that illustrates spatial relationships, it’s natural to assume that the position of each element (e.g., a bar) reflects an actual, physical location. When we violate this assumption, we undermine the visual integrity of the map. This can handicap our analysis. This is particularly true given that 44% (257/578) of the bars in Snow’s map fall into the second, geographically uninformative category.</p>
<p>To address these problems, I “unstack” Dodson and Tobler’s data. I do so in two ways. In the first, I give all all cases in a stack (i.e., at the same “address”) the same x-y coordinate. These data are available in <code>fatalities.unstacked</code>. In the second, I make the address rather than the the case the unit of observation: each address is a single observation with a single x-y coordinate, and the number of cases observed at that location is an attribute of that address. These data are available in <code>fatalities.address</code>.</p>
</div>
<div id="data-details" class="section level2">
<h2 class="hasAnchor">
<a href="#data-details" class="anchor"></a>Data details</h2>
<p>To illustrate the differences between the two data sets, consider how they handle the largest outlier on Snow’s map: the eighteen cases at 38 Broad Street.</p>
<p>With <code>fatalities</code>, all members of the stack have different coordinates:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## The 18 cases at 38 Broad Street ##

broad38 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">239</span>, <span class="dv">12</span>, <span class="dv">310</span>, <span class="dv">398</span>, <span class="dv">562</span>, <span class="dv">397</span>, <span class="dv">421</span>, <span class="dv">190</span>, <span class="dv">290</span>, <span class="dv">61</span>, <span class="dv">174</span>, <span class="dv">547</span>, <span class="dv">523</span>,
             <span class="dv">521</span>, <span class="dv">138</span>, <span class="dv">59</span>, <span class="dv">340</span>, <span class="dv">508</span>)

fatalities[fatalities<span class="op">$</span>case <span class="op">%in%</span><span class="st"> </span>broad38, ]
<span class="co">#&gt;     case        x        y</span>
<span class="co">#&gt; 12    12 12.34107 11.48214</span>
<span class="co">#&gt; 59    59 12.58271 11.01057</span>
<span class="co">#&gt; 61    61 12.47289 11.21463</span>
<span class="co">#&gt; 138  138 12.56326 11.04593</span>
<span class="co">#&gt; 174  174 12.48731 11.17735</span>
<span class="co">#&gt; 190  190 12.44094 11.28124</span>
<span class="co">#&gt; 239  239 12.31552 11.51159</span>
<span class="co">#&gt; 290  290 12.45943 11.24890</span>
<span class="co">#&gt; 310  310 12.35546 11.44285</span>
<span class="co">#&gt; 340  340 12.59532 10.98533</span>
<span class="co">#&gt; 397  397 12.40901 11.34986</span>
<span class="co">#&gt; 398  398 12.36903 11.41560</span>
<span class="co">#&gt; 421  421 12.42551 11.31754</span>
<span class="co">#&gt; 508  508 12.61480 10.95197</span>
<span class="co">#&gt; 521  521 12.54972 11.07519</span>
<span class="co">#&gt; 523  523 12.53218 11.10452</span>
<span class="co">#&gt; 547  547 12.51176 11.14190</span>
<span class="co">#&gt; 562  562 12.39045 11.37820</span></code></pre></div>
<p>With <code>fatalities.unstacked</code>, all members of the stack have the same coordinate:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fatalities.unstacked[fatalities.unstacked<span class="op">$</span>case <span class="op">%in%</span><span class="st"> </span>broad38, ]
<span class="co">#&gt;     case        x        y</span>
<span class="co">#&gt; 12    12 12.31552 11.51159</span>
<span class="co">#&gt; 59    59 12.31552 11.51159</span>
<span class="co">#&gt; 61    61 12.31552 11.51159</span>
<span class="co">#&gt; 138  138 12.31552 11.51159</span>
<span class="co">#&gt; 174  174 12.31552 11.51159</span>
<span class="co">#&gt; 190  190 12.31552 11.51159</span>
<span class="co">#&gt; 239  239 12.31552 11.51159</span>
<span class="co">#&gt; 290  290 12.31552 11.51159</span>
<span class="co">#&gt; 310  310 12.31552 11.51159</span>
<span class="co">#&gt; 340  340 12.31552 11.51159</span>
<span class="co">#&gt; 397  397 12.31552 11.51159</span>
<span class="co">#&gt; 398  398 12.31552 11.51159</span>
<span class="co">#&gt; 421  421 12.31552 11.51159</span>
<span class="co">#&gt; 508  508 12.31552 11.51159</span>
<span class="co">#&gt; 521  521 12.31552 11.51159</span>
<span class="co">#&gt; 523  523 12.31552 11.51159</span>
<span class="co">#&gt; 547  547 12.31552 11.51159</span>
<span class="co">#&gt; 562  562 12.31552 11.51159</span></code></pre></div>
<p>With <code>fatalities.address</code>, the 18 cases are represented by a single observation, case 239, which serves as the “address”:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fatalities.address[<span class="dv">136</span><span class="op">:</span><span class="dv">140</span>, ]
<span class="co">#&gt;     anchor.case         x        y case.count</span>
<span class="co">#&gt; 236         237 15.775540 13.98787          2</span>
<span class="co">#&gt; 238         238 12.900190 10.33882          1</span>
<span class="co">#&gt; 239         239 12.315520 11.51159         18</span>
<span class="co">#&gt; 257         240  9.794394 11.77236          1</span>
<span class="co">#&gt; 258         242 12.677590 12.05460          1</span></code></pre></div>
</div>
<div id="virtues-of-unstacking" class="section level2">
<h2 class="hasAnchor">
<a href="#virtues-of-unstacking" class="anchor"></a>Virtues of “unstacking”</h2>
<p>To illustrate the virtues of “unstacked” data, consider the following.</p>
<div id="kernel-density-contours" class="section level3">
<h3 class="hasAnchor">
<a href="#kernel-density-contours" class="anchor"></a>Kernel density contours</h3>
<p>The graphs below plot the bivariate kernel density contours, of varying bandwidths, on the “stacked” and “unstacked” data. The contours help illustrate the spatial distribution or topography of fatalities, and provide an estimate of the epicenter of the outbreak.</p>
<p>With the “stacked” data, <code>fatalities</code>, the contours are looser (reflecting lower proximity) and the epicenter is further south than what we might expect given that the Broad Street pump (blue triangle)<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a> is the accepted source of the outbreak. The problem is that the “vertical” stack of 18 cases (west of the pump at 38 Broad Street) and the “horizontal” stack of 5 cases (south of the pump at 10 Cambridge Street) pull the fit downward in a southerly direction.</p>
<p><img src="unstacking.bars_files/figure-html/unnamed-chunk-6-1.png" width="480" style="display: block; margin: auto;"></p>
<p>With <code>fatalities.unstacked</code>, the contours are “tighter” (reflecting greater proximity) and the epicenter is located further north, nearer to the pump and to Broad Street:</p>
<p><img src="unstacking.bars_files/figure-html/unnamed-chunk-7-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="unstacking-via-classification" class="section level2">
<h2 class="hasAnchor">
<a href="#unstacking-via-classification" class="anchor"></a>“Unstacking” via classification</h2>
<p>The main roadblock to “unstacking” is that there is no notion of an “address” in the data: bars are merely points and streets are merely line segments.<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a> Nothing links a point to a segments. And nothing connects one bar in a stack to another bar. All elements exist independently of one another. The only reason why the map “works” is that the fatalities and roads data have overlapping x-y coordinates.</p>
<p>To “unstack” the data, we need to match each bar to a specific road (segment) and to a specific stack. To accomplish these tasks, I use two types of classification. For those interested, the details are found in “Computing Street Addresses”, which is available <a href="https://github.com/lindbrook/cholera/blob/master/docs/unstacking.bars.notes.md">online</a> in this package’s GitHub repository.</p>
</div>
<div id="notes" class="section level2">
<h2 class="hasAnchor">
<a href="#notes" class="anchor"></a>Notes</h2>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>The map was originally published in Snow’s 1855 book “On The Mode Of Communication Of Cholera”, which was reprinted as John Snow et. al., 1936. <em>Snow on Cholera: Being a Reprint of Two Papers</em>. New York: The Common Wealth Fund. You can also find the map online (a high resolution version is available at <a href="http://www.ph.ucla.edu/epi/snow/highressnowmap.html" class="uri">http://www.ph.ucla.edu/epi/snow/highressnowmap.html</a>) and in many books, including Edward Tufte’s 1997 “Visual Explanations: Images and Quantities, Evidence and Narrative”.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p><a href="http://www.ncgia.ucsb.edu/pubs/snow/snow.html" class="uri">http://www.ncgia.ucsb.edu/pubs/snow/snow.html</a><a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>The blue triangle is the “correct” location of the pump as included in the amended, second version of the map that appears in the Vestry report. The empty green triangle is the pump’s “wrong” location from the original map.<a href="#fnref3">↩</a></p></li>
<li id="fn4"><p>In Friendly’s ‘HistData’ package, these data are called <code>Snow.deaths</code> and <code>Snow.streets</code>.<a href="#fnref4">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#data-details">Data details</a></li>
      <li><a href="#virtues-of-unstacking">Virtues of “unstacking”</a></li>
      <li><a href="#unstacking-via-classification">“Unstacking” via classification</a></li>
      <li><a href="#notes">Notes</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by lindbrook.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
