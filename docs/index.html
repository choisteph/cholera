<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Amend, Augment and Aid Analysis of John Snow's Cholera Map • cholera</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Amend, Augment and Aid Analysis of John Snow's Cholera Map">
<meta property="og:description" content="Amends errors, augments data and aids analysis of John Snow's map
  of the 1854 London cholera outbreak.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">cholera</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.9.9024</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/duplicate.missing.cases.html">Duplicate and Missing Cases</a>
    </li>
    <li>
      <a href="articles/kernel.density.html">Kernel Density Plot</a>
    </li>
    <li>
      <a href="articles/notes/duplicate.missing.cases.notes.html">* note on duplicate and missing cases</a>
    </li>
    <li>
      <a href="articles/notes/euclidean.voronoi.html">* Euclidean v. Voronoi neighborhoods</a>
    </li>
    <li>
      <a href="articles/notes/pump.neighborhoods.notes.html">* points v. polygons</a>
    </li>
    <li>
      <a href="articles/notes/references.html">* References</a>
    </li>
    <li>
      <a href="articles/notes/unstacking.bars.notes.html">* computing street addressess</a>
    </li>
    <li>
      <a href="articles/pump.neighborhoods.html">Pump Neighborhoods</a>
    </li>
    <li>
      <a href="articles/roads.html">Roads</a>
    </li>
    <li>
      <a href="articles/tiles.polygons.html">deldirPolygons(): Tiles, Triangles and Polygons</a>
    </li>
    <li>
      <a href="articles/time.series.html">Time Series</a>
    </li>
    <li>
      <a href="articles/unstacking.bars.html">"Unstacking" Bars</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lindbrook/cholera">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->

<div id="cholera-amend-augment-and-aid-analysis-of-snows-cholera-map" class="section level2">
<h2 class="hasAnchor">
<a href="#cholera-amend-augment-and-aid-analysis-of-snows-cholera-map" class="anchor"></a>cholera: amend, augment and aid analysis of Snow’s cholera map</h2>
<div id="package-features" class="section level3">
<h3 class="hasAnchor">
<a href="#package-features" class="anchor"></a>package features</h3>
<ul>
<li>Fixes three apparent coding errors in Dodson and Tobler’s 1992 digitization of Snow’s map.</li>
<li>“Unstacks” the data in two ways to make analysis and visualization easier and more meaningful.</li>
<li>Computes and visualizes “pump neighborhoods” based on Voronoi tessellation, Euclidean distance, and walking distance.</li>
<li>Ability to overlay graphical elements and features like kernel density, Voronoi diagrams, Snow’s Broad Street neighborhood, and notable landmarks (John Snow’s residence, the Lion Brewery, etc.) via <code>add*()</code> functions.</li>
<li>Includes a variety of functions to highlight specific cases, roads, pumps and paths.</li>
<li>Appends street names to the roads data set.</li>
<li>Includes the revised pump data used in the second version of Snow’s map from the Vestry report, which includes the “correct” location of the Broad Street pump.</li>
<li>Adds two different aggregate time series fatalities data sets, taken from the Vestry report.</li>
</ul>
</div>
<div id="background" class="section level3">
<h3 class="hasAnchor">
<a href="#background" class="anchor"></a>background</h3>
<p>John Snow’s map of the 1854 cholera outbreak in London is one of the best known examples of data visualization and information design.</p>
<div class="figure">
<img src="../../Data%20IV/cholera/vignettes/msu-snows-mapB.jpg">
</div>
<p>By plotting the number and location of fatalities on a map, Snow was able to do something that is easily taken for granted today: the ability to create and disseminate a visualization of a spatial distribution. To our modern eye, the pattern is unmistakable. It seems self-evident that the map elegantly supports Snow’s claims that cholera is a waterborne disease and that the pump on Broad Street is the source of the outbreak. And yet, despite its virtues, the map failed to convince both the authorities and Snow’s colleagues in the medical and scientific communities.</p>
<p>Beyond considerations of time and place, there are “scientific” reasons for this failure. The map shows a concentration of cases around the Broad Street pump, but that alone should not convince us that Snow is right. The map doesn’t refute the primary rival explanation, miasma theory: the pattern we see is not unlike what airborne transmission might look like. And while the presence of a pump near or at the epicenter of the distribution of fatalities is strong circumstantial evidence, it is still circumstantial. There are a host of rival explanations that the map doesn’t consider and cannot rule out: location of sewer grates, elevation, weather patterns, etc..</p>
<p>Arguably, this may be one reason why Snow added a graphical annotation to the second, lesser-known version of the map that was published in the official report on the outbreak (<em>Report On The Cholera Outbreak In The Parish Of St. James, Westminster, During The Autumn Of 1854</em>):</p>
<div class="figure">
<img src="../../Data%20IV/cholera/vignettes/fig12-6.png">
</div>
</div>
<div id="pump-neighborhoods" class="section level3">
<h3 class="hasAnchor">
<a href="#pump-neighborhoods" class="anchor"></a>pump neighborhoods</h3>
<p>The annotation outlines what we might call the Broad Street <em>pump neighborhood</em>: the set of addresses that are, according to Snow, within “close” walking distance to the pump. The notion of a pump neighborhood is important because it provides a prediction about where we should and should <em>not</em> expect to find cases. If water is cholera’s mode of transmission and if water pumps are the primary source of drinking water, then most, if not all, fatalities should be found <em>within</em> the pump neighborhood. The disease should stop at the neighborhood’s borders.</p>
<p>Creating this annotation is not a trivial matter. To identify the neighborhood of the Broad Street pump, you need to identify the neighborhoods of surrounding pumps. Snow writes: “The inner dotted line on the map shews [sic] the various points which have been found by careful measurement to be at an equal distance by the nearest road from the pump in Broad Street and the surrounding pumps …” (Ibid., p. 109.).</p>
<p>I build on Snow’s efforts by writing functions that allow you to compute three flavors of pump neighborhoods. The first is based on Voronoi tessellation. It works by using the Euclidean distances between pumps. It’s easy to compute and has been a popular choice for analysts of Snow’s map. However, it has two drawbacks: 1) roads and buildings play no role in determining neighborhoods (it assumes that people walk directly, “as the crow flies”, to their preferred pump); and 2) it’s not what Snow has in mind. For that, you’ll need to consider the second type of neighborhood.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="reference/neighborhoodVoronoi.html">neighborhoodVoronoi</a></span>())</code></pre></div>
<p><img src="../../Data%20IV/cholera/man/figures/README-voronoi-1.png" width="576"></p>
<p>The second flavor is based on the Euclidean distances between cases and pumps. This serves as a check on the Voronoi-based method, as a more granular estimate of Euclidean distance based neighborhoods, and provides a more flexible way to visualize Euclidean distance based neighborhoods.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="reference/neighborhoodEuclidean.html">neighborhoodEuclidean</a></span>())</code></pre></div>
<p><img src="../../Data%20IV/cholera/man/figures/README-euclidean-1.png" width="576"></p>
<p>The third and final flavor is based on the walking distance along the roads on the map. While more accurate, it’s computationally more demanding. To compute these distances, I transform the roads on the map into a network graph and turn the computation of walking distance into a graph theory problem. For each case (observed or simulated), I compute the shortest path, weighted by the length of roads (edges), to the nearest pump. “Rinse and repeat” and the different pump neighborhoods emerge:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="reference/neighborhoodWalking.html">neighborhoodWalking</a></span>())</code></pre></div>
<p><img src="../../Data%20IV/cholera/man/figures/README-walk-1.png" width="576"></p>
<p>To explore the data, you can consider a variety of scenarios by computing different sets of neighborhoods. Here’s the result excluding the Broad Street pump.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="reference/neighborhoodWalking.html">neighborhoodWalking</a></span>(<span class="op">-</span><span class="dv">7</span>))</code></pre></div>
<p><img src="../../Data%20IV/cholera/man/figures/README-walk7-1.png" width="576"></p>
</div>
<div id="expected-pump-neighborhoods" class="section level3">
<h3 class="hasAnchor">
<a href="#expected-pump-neighborhoods" class="anchor"></a>“expected” pump neighborhoods</h3>
<p>You can also explore “expected” neighborhoods. Currently, you can do so in three ways. The first colors roads.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="reference/neighborhoodWalking.html">neighborhoodWalking</a></span>(<span class="dt">case.set =</span> <span class="st">"expected"</span>))</code></pre></div>
<p><img src="../../Data%20IV/cholera/man/figures/README-expected-1.png" width="576"></p>
<p>The second colors the expected area of neighborhoods using points().</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="reference/neighborhoodWalking.html">neighborhoodWalking</a></span>(<span class="dt">case.set =</span> <span class="st">"expected"</span>), <span class="dt">type =</span> <span class="st">"area.points"</span>)</code></pre></div>
<p><img src="../../Data%20IV/cholera/man/figures/README-expected_area_points-1.png" width="576"></p>
<p>The third colors the expected area of neighborhoods using polygon().</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="reference/neighborhoodWalking.html">neighborhoodWalking</a></span>(<span class="dt">case.set =</span> <span class="st">"expected"</span>), <span class="dt">type =</span> <span class="st">"area.polygons"</span>)</code></pre></div>
<p><img src="../../Data%20IV/cholera/man/figures/README-expected_area_polygons-1.png" width="576"></p>
<p>For exploration, the first two options are faster.</p>
</div>
<div id="getting-started" class="section level3">
<h3 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>getting started</h3>
<p>To install ‘cholera’ from CRAN:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"cholera"</span>)</code></pre></div>
<p>To install the development version of ‘cholera’ from GitHub:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Note that you may need to install the 'devtools' package:</span>
<span class="co"># install.packages("devtools")</span>

<span class="co"># For 'devtools' (&lt; 2.0.0)</span>
devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"lindbrook/cholera"</span>, <span class="dt">build_vignettes =</span> <span class="ot">TRUE</span>)

<span class="co"># For 'devtools' (&gt;= 2.0.0)</span>
devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"lindbrook/cholera"</span>, <span class="dt">build_opts =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"--no-resave-data"</span>, <span class="st">"--no-manual"</span>))</code></pre></div>
</div>
<div id="vignettes" class="section level3">
<h3 class="hasAnchor">
<a href="#vignettes" class="anchor"></a>vignettes</h3>
<p>The vignettes expand on the concept of a “pump neighborhood”, and go into greater detail on how I fix the data and compute walking distances and walking neighborhoods. They are included in the package and available online at the links below:</p>
<p><a href="https://github.com/lindbrook/cholera/blob/master/docs/duplicate.missing.cases.md">Duplicate and Missing Cases</a> briefly outline the two coding errors and three misplaced cases I find in Dodson and Tobler’s (1992) digitization of Snow’s map. Details of the fix are in “Note on Duplicate and Missing Cases”, discussed below.</p>
<p><a href="https://github.com/lindbrook/cholera/blob/master/docs/kernel.density.md">Kernel Density Plot</a> discusses the the syntax of <code><a href="reference/addKernelDensity.html">addKernelDensity()</a></code>, which allows you to define “populations” and subsets of pumps. This syntax is used in many of the functions in ‘cholera’.</p>
<p><a href="https://github.com/lindbrook/cholera/blob/master/docs/pump.neighborhoods.md">Pump Neighborhoods</a> discusses the notion of a pump neighborhood and describes the two flavors of neighborhoods, which are based on Euclidean (i.e., <code><a href="reference/neighborhoodEuclidean.html">neighborhoodEuclidean()</a></code> and <code>neighborhoodVoronoi</code>) and walking distance (i.e., <code><a href="reference/neighborhoodWalking.html">neighborhoodWalking()</a></code>).</p>
<p><a href="https://github.com/lindbrook/cholera/blob/master/docs/roads.md">Roads</a> covers road related issues. This includes discussion of the structure of the <code>roads</code> data frame, the list of “valid” road names, and the back of the envelope translation from the map’s nominal scale to meters (and yards).</p>
<p><a href="https://github.com/lindbrook/cholera/blob/master/docs/tiles.polygons.md">deldirPolygons(): Tiles, Triangles and Polygons</a> focuses on the <code><a href="reference/deldirPolygons.html">deldirPolygons()</a></code>, which might be of use beyond this package. The function extracts the vertices of triangles (Delauny triangulation) and tiles (Dirichelet or Voronoi tessellation) from <code><a href="https://www.rdocumentation.org/packages/deldir/topics/deldir">deldir::deldir()</a></code> for use with polygon based functions.</p>
<p><a href="https://github.com/lindbrook/cholera/blob/master/docs/time.series.md">Time Series</a> discusses functions and data related to fatalities time series data and the effect of the removal of the handle from the Broad Street pump.</p>
<p><a href="https://github.com/lindbrook/cholera/blob/master/docs/unstacking.bars.md">“Unstacking” Bars</a> discusses the inferential and visual importance of “unstacking” the bars in Snow’s map.</p>
</div>
<div id="notes" class="section level3">
<h3 class="hasAnchor">
<a href="#notes" class="anchor"></a>notes</h3>
<p>The notes below, which are only available online, go into greater detail about various issues and topics:</p>
<p><a href="https://github.com/lindbrook/cholera/blob/master/docs/pump.neighborhoods.notes.md">* points v. polygons</a> discusses the tradeoff between using points() and polygon() to plot “expected” neighborhoods and how the polygon vertices were computed.</p>
<p><a href="https://github.com/lindbrook/cholera/blob/master/docs/duplicate.missing.cases.notes.md">* note on duplicate and missing cases</a> documents the specifics of how I “fixed” two apparent coding errors and three misplaced case in Dodson and Tobler’s data.</p>
<p><a href="https://github.com/lindbrook/cholera/blob/master/docs/unstacking.bars.notes.md">* computing street addressess</a> discusses how orthogonal projection and hierarchical cluster analysis is used to “unstack” bars and provide each stack an “address”.</p>
<p><a href="https://github.com/lindbrook/cholera/blob/master/docs/euclidean.voronoi.md">* Euclidean v. Voronoi neighborhoods</a> discusses why there are separate functions for <code><a href="reference/neighborhoodEuclidean.html">neighborhoodEuclidean()</a></code> and <code><a href="reference/neighborhoodVoronoi.html">neighborhoodVoronoi()</a></code>.</p>
</div>
<div id="note-on-computating-of-neighborhoodwalking" class="section level3">
<h3 class="hasAnchor">
<a href="#note-on-computating-of-neighborhoodwalking" class="anchor"></a>note on computating of <code><a href="reference/neighborhoodWalking.html">neighborhoodWalking()</a></code>
</h3>
<p><code><a href="reference/neighborhoodWalking.html">neighborhoodWalking()</a></code> is computationally intensive. Using R version 3.5.1 on a single core of a 2.3 GHz Intel i7, plotting observed paths to PDF takes about 5 seconds; doing the same for expected paths takes about 28 seconds. Using the functions’ parallel implementation on 4 physical (8 logical) cores, the times fall to about 4 and 11 seconds.</p>
<p>Note that parallelization is currently only available on Linux and Mac.</p>
<p>Also, note that although some precautions are taken in R.app on macOS, the developers of the ‘parallel’ package, which <code><a href="reference/neighborhoodWalking.html">neighborhoodWalking()</a></code> uses, strongly discourage against using parallelization within a GUI or embedded environment. See <code>vignette("parallel")</code> for details.</p>
</div>
<div id="contributing" class="section level3">
<h3 class="hasAnchor">
<a href="#contributing" class="anchor"></a>contributing</h3>
<p>Contributions to the ‘cholera’ package are welcome. If interested, please see the suggested <a href="https://github.com/lindbrook/cholera/blob/master/CONTRIBUTING.md">guidelines</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=cholera">https://​cloud.r-project.org/​package=cholera</a>
</li>
<li>Browse source code at <br><a href="https://github.com/lindbrook/cholera">https://​github.com/​lindbrook/​cholera</a>
</li>
<li>Report a bug at <br><a href="https://github.com/lindbrook/cholera/issues">https://​github.com/​lindbrook/​cholera/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 2)</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>lindbrook <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=cholera"><img src="http://www.r-pkg.org/badges/version/cholera" alt="CRAN_Status_Badge"></a></li>
<li><a href="https://github.com/lindbrook/cholera/blob/master/NEWS"><img src="https://img.shields.io/badge/GitHub-0.5.9.9024-red.svg" alt="GitHub_Status_Badge"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by lindbrook.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
